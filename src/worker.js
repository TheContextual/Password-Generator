var wordList = ["acorn", "acre",
    "acts",
    "afar",
    "agent",
    "agile",
    "ahead",
    "aim",
    "ajar",
    "alarm",
    "alias",
    "alibi",
    "alien",
    "alike",
    "alive",
    "aloe",
    "aloft",
    "alone",
    "amend",
    "ample",
    "amuse",
    "angel",
    "angle",
    "ankle",
    "apple",
    "april",
    "apron",
    "aqua",
    "area",
    "arena",
    "arise",
    "armor",
    "aroma",
    "array",
    "art",
    "atlas",
    "atom",
    "attic",
    "audio",
    "avert",
    "awake",
    "award",
    "awoke",
    "axis",
    "bacon",
    "badge",
    "bagel",
    "baked",
    "banjo",
    "barge",
    "barn",
    "basil",
    "batch",
    "bath",
    "bats",
    "blade",
    "blank",
    "blend",
    "bless",
    "blimp",
    "blink",
    "blob",
    "blog",
    "boast",
    "boat",
    "body",
    "boil",
    "bolt",
    "bonus",
    "book",
    "booth",
    "boots",
    "boss",
    "botch",
    "both",
    "boxer",
    "bribe",
    "brick",
    "brim",
    "bring",
    "brisk",
    "broad",
    "broke",
    "brook",
    "broom",
    "brush",
    "buck",
    "buggy",
    "bunch",
    "bush",
    "busy",
    "cable",
    "cache",
    "cadet",
    "cake",
    "calm",
    "cameo",
    "canal",
    "candy",
    "cane",
    "canon",
    "cape",
    "card",
    "cargo",
    "carol",
    "carry",
    "case",
    "cash",
    "cause",
    "cedar",
    "chain",
    "chair",
    "chant",
    "charm",
    "chase",
    "cheek",
    "cheer",
    "chef",
    "chess",
    "chest",
    "chief",
    "chili",
    "chill",
    "chip",
    "chuck",
    "chunk",
    "chute",
    "cider",
    "city",
    "civic",
    "civil",
    "claim",
    "class",
    "claw",
    "clay",
    "clean",
    "clear",
    "clerk",
    "click",
    "clip",
    "cloak",
    "clock",
    "clone",
    "cloth",
    "cloud",
    "coach",
    "coast",
    "coat",
    "cod",
    "coil",
    "coke",
    "cola",
    "cold",
    "colt",
    "comic",
    "comma",
    "cone",
    "copy",
    "coral",
    "cork",
    "cost",
    "couch",
    "cover",
    "cozy",
    "craft",
    "crane",
    "crate",
    "crave",
    "crawl",
    "creme",
    "crepe",
    "crept",
    "crib",
    "crisp",
    "crop",
    "cross",
    "crowd",
    "crown",
    "crumb",
    "crush",
    "crust",
    "cupid",
    "cure",
    "curl",
    "curry",
    "curve",
    "cut",
    "cycle",
    "daily",
    "dairy",
    "daisy",
    "dance",
    "dandy",
    "dash",
    "data",
    "date",
    "dawn",
    "deal",
    "dean",
    "debit",
    "debt",
    "debug",
    "decaf",
    "decal",
    "deck",
    "decor",
    "decoy",
    "deed",
    "delay",
    "denim",
    "dent",
    "depth",
    "derby",
    "desk",
    "dial",
    "diary",
    "dice",
    "dig",
    "dill",
    "dime",
    "dimly",
    "diner",
    "disco",
    "dish",
    "disk",
    "dodge",
    "doll",
    "donor",
    "donut",
    "dot",
    "dove",
    "down",
    "doze",
    "drank",
    "draw",
    "dress",
    "dried",
    "drift",
    "drill",
    "drive",
    "drone",
    "droop",
    "drove",
    "drum",
    "dry",
    "duck",
    "duct",
    "dug",
    "duke",
    "duo",
    "dusk",
    "dust",
    "duty",
    "dwarf",
    "dwell",
    "eagle",
    "early",
    "earth",
    "east",
    "ebay",
    "ebook",
    "echo",
    "eel",
    "elbow",
    "elder",
    "elf",
    "elk",
    "email",
    "empty",
    "emu",
    "enter",
    "entry",
    "envoy",
    "equal",
    "error",
    "essay",
    "etch",
    "evade",
    "even",
    "evict",
    "evoke",
    "exact",
    "exit",
    "fable",
    "faced",
    "fact",
    "fade",
    "fall",
    "false",
    "fancy",
    "fang",
    "feast",
    "feed",
    "fence",
    "fend",
    "ferry",
    "fetch",
    "fever",
    "fiber",
    "fifth",
    "fifty",
    "film",
    "final",
    "finch",
    "fit",
    "five",
    "flag",
    "flaky",
    "flame",
    "flask",
    "fled",
    "flick",
    "flint",
    "float",
    "flock",
    "floss",
    "flyer",
    "foam",
    "fog",
    "foil",
    "folic",
    "folk",
    "food",
    "fool",
    "found",
    "fox",
    "frame",
    "fray",
    "fresh",
    "fried",
    "frill",
    "frisk",
    "from",
    "front",
    "frost",
    "froth",
    "froze",
    "fruit",
    "game",
    "gap",
    "gas",
    "gave",
    "gear",
    "gecko",
    "geek",
    "gem",
    "genre",
    "gift",
    "gig",
    "gills",
    "given",
    "giver",
    "glad",
    "glass",
    "glide",
    "gloss",
    "glove",
    "glow",
    "glue",
    "goal",
    "going",
    "golf",
    "gong",
    "good",
    "goofy",
    "gore",
    "gown",
    "grab",
    "grain",
    "grant",
    "grape",
    "graph",
    "grasp",
    "grass",
    "grave",
    "gravy",
    "gray",
    "green",
    "greet",
    "grew",
    "grid",
    "grief",
    "grill",
    "growl",
    "grub",
    "guide",
    "gulf",
    "gummy",
    "guru",
    "guy",
    "habit",
    "half",
    "halo",
    "halt",
    "happy",
    "hash",
    "hasty",
    "hatch",
    "haven",
    "hazel",
    "hazy",
    "heap",
    "heat",
    "heave",
    "hedge",
    "hefty",
    "help",
    "herbs",
    "hub",
    "hug",
    "hula",
    "hull",
    "human",
    "humid",
    "hunk",
    "hurry",
    "hush",
    "hut",
    "ice",
    "icing",
    "icon",
    "icy",
    "igloo",
    "image",
    "ion",
    "iron",
    "item",
    "ivory",
    "ivy",
    "jam",
    "jazz",
    "jeep",
    "jelly",
    "jet",
    "jiffy",
    "job",
    "jog",
    "jolly",
    "jolt",
    "joy",
    "judge",
    "juice",
    "juicy",
    "july",
    "jumbo",
    "jump",
    "junky",
    "jury",
    "keep",
    "keg",
    "kept",
    "kick",
    "kilt",
    "king",
    "kite",
    "kitty",
    "kiwi",
    "knee",
    "knelt",
    "koala",
    "kung",
    "ladle",
    "lair",
    "lake",
    "lance",
    "land",
    "large",
    "lash",
    "lasso",
    "last",
    "latch",
    "late",
    "lazy",
    "left",
    "legal",
    "lemon",
    "lend",
    "lens",
    "lent",
    "level",
    "lever",
    "lid",
    "life",
    "lift",
    "lilac",
    "lily",
    "limes",
    "line",
    "lint",
    "lion",
    "lip",
    "list",
    "lived",
    "lunar",
    "lunch",
    "lying",
    "lyric",
    "mace",
    "maker",
    "malt",
    "mama",
    "mango",
    "manor",
    "many",
    "map",
    "march",
    "marry",
    "mash",
    "match",
    "math",
    "mocha",
    "morse",
    "most",
    "motor",
    "motto",
    "mount",
    "mouse",
    "mousy",
    "move",
    "movie",
    "mower",
    "mud",
    "mug",
    "mule",
    "mull",
    "mumbo",
    "mural",
    "muse",
    "music",
    "mute",
    "nacho",
    "nag",
    "nail",
    "name",
    "nap",
    "navy",
    "near",
    "neat",
    "neon",
    "nest",
    "net",
    "next",
    "niece",
    "ninth",
    "nutty",
    "oak",
    "oasis",
    "oat",
    "ocean",
    "oil",
    "old",
    "olive",
    "omen",
    "onion",
    "only",
    "opal",
    "open",
    "opera",
    "opt",
    "otter",
    "ounce",
    "outer",
    "oval",
    "oven",
    "owl",
    "ozone",
    "pace",
    "pager",
    "palm",
    "panda",
    "pants",
    "paper",
    "park",
    "party",
    "pasta",
    "patch",
    "path",
    "patio",
    "pecan",
    "penny",
    "perch",
    "petal",
    "photo",
    "plank",
    "plant",
    "plaza",
    "plot",
    "plus",
    "poach",
    "pod",
    "poem",
    "poet",
    "pogo",
    "point",
    "poise",
    "poker",
    "polar",
    "polka",
    "polo",
    "pond",
    "pony",
    "poppy",
    "pork",
    "pouch",
    "power",
    "press",
    "print",
    "prior",
    "prism",
    "prize",
    "probe",
    "proof",
    "props",
    "prune",
    "pug",
    "pull",
    "pulp",
    "pulse",
    "puma",
    "punch",
    "punk",
    "pupil",
    "puppy",
    "purse",
    "push",
    "putt",
    "quack",
    "query",
    "quiet",
    "quill",
    "quilt",
    "quit",
    "quota",
    "quote",
    "radar",
    "radio",
    "raft",
    "raid",
    "rake",
    "rally",
    "ramp",
    "ranch",
    "range",
    "rank",
    "raven",
    "reach",
    "react",
    "rebel",
    "recap",
    "relax",
    "relay",
    "relic",
    "remix",
    "repay",
    "repel",
    "reply",
    "rerun",
    "reset",
    "rhyme",
    "rice",
    "rich",
    "ride",
    "rigid",
    "rinse",
    "rise",
    "rival",
    "river",
    "roast",
    "robe",
    "robin",
    "rock",
    "rogue",
    "roman",
    "rope",
    "rover",
    "royal",
    "ruby",
    "rug",
    "rule",
    "rush",
    "rust",
    "sage",
    "saint",
    "salad",
    "salon",
    "salsa",
    "salt",
    "sandy",
    "santa",
    "sauna",
    "saved",
    "savor",
    "scale",
    "scan",
    "scarf",
    "scoop",
    "scope",
    "score",
    "scout",
    "scuba",
    "sect",
    "sedan",
    "self",
    "send",
    "serve",
    "set",
    "seven",
    "shack",
    "shade",
    "shape",
    "share",
    "sharp",
    "shed",
    "sheep",
    "sheet",
    "shelf",
    "shell",
    "shine",
    "shiny",
    "ship",
    "shirt",
    "shock",
    "shop",
    "shore",
    "shown",
    "shy",
    "sift",
    "silk",
    "silo",
    "siren",
    "sixth",
    "size",
    "skate",
    "skew",
    "skier",
    "skies",
    "skip",
    "skit",
    "sky",
    "slab",
    "slack",
    "slam",
    "slate",
    "slaw",
    "sled",
    "sleek",
    "sleep",
    "sleet",
    "slept",
    "slice",
    "slick",
    "slip",
    "slot",
    "small",
    "smile",
    "smog",
    "snack",
    "snap",
    "snare",
    "sneak",
    "sneer",
    "snout",
    "snowy",
    "snub",
    "snuff",
    "speak",
    "speed",
    "spend",
    "spent",
    "spew",
    "spied",
    "spiny",
    "spoke",
    "spool",
    "spoon",
    "sport",
    "spot",
    "spout",
    "spray",
    "spree",
    "spur",
    "squad",
    "squat",
    "squid",
    "stack",
    "staff",
    "stage",
    "stall",
    "stamp",
    "stand",
    "stark",
    "start",
    "stash",
    "state",
    "stays",
    "steam",
    "steep",
    "stem",
    "step",
    "stew",
    "stick",
    "stir",
    "stock",
    "stomp",
    "stony",
    "stood",
    "stop",
    "storm",
    "stove",
    "straw",
    "stray",
    "strut",
    "stuck",
    "stuff",
    "stump",
    "stunt",
    "sugar",
    "surf",
    "sushi",
    "swan",
    "swarm",
    "sway",
    "swear",
    "sweat",
    "sweep",
    "swell",
    "swept",
    "swim",
    "swing",
    "swoop",
    "syrup",
    "taco",
    "tag",
    "take",
    "tall",
    "talon",
    "tamer",
    "tank",
    "taps",
    "tarot",
    "tart",
    "task",
    "taste",
    "thank",
    "theme",
    "thing",
    "think",
    "thorn",
    "those",
    "thumb",
    "thus",
    "tiara",
    "tidal",
    "tidy",
    "tiger",
    "tile",
    "tilt",
    "tint",
    "tiny",
    "trace",
    "track",
    "trade",
    "train",
    "trait",
    "tray",
    "treat",
    "tree",
    "trek",
    "trend",
    "trial",
    "tribe",
    "trick",
    "trio",
    "trout",
    "truce",
    "truck",
    "trunk",
    "try",
    "tug",
    "tulip",
    "turf",
    "tusk",
    "tutor",
    "tweak",
    "twice",
    "twine",
    "twins",
    "twirl",
    "twist",
    "uncle",
    "undo",
    "unify",
    "union",
    "unit",
    "upon",
    "upper",
    "urban",
    "used",
    "user",
    "usher",
    "utter",
    "value",
    "vapor",
    "vegan",
    "venue",
    "verse",
    "vest",
    "veto",
    "vice",
    "video",
    "view",
    "visa",
    "visor",
    "vocal",
    "voice",
    "void",
    "volt",
    "voter",
    "vowel",
    "wafer",
    "wager",
    "wagon",
    "wake",
    "walk",
    "wand",
    "wasp",
    "watch",
    "water",
    "wavy",
    "wheat",
    "whole",
    "wick",
    "widen",
    "width",
    "wifi",
    "wind",
    "wing",
    "wired",
    "wise",
    "wish",
    "wok",
    "wolf",
    "womb",
    "wool",
    "word",
    "work",
    "worry",
    "wound",
    "woven",
    "wrath",
    "wreck",
    "wrist",
    "yam",
    "yard",
    "year",
    "yeast",
    "yield",
    "yoga",
    "yoyo",
    "zebra",
    "zero",
    "zone",
    "zoom" ]

var password = "";

window.addEventListener("DOMContentLoaded", function() {
    // adding the event listener to the button
    // we have to do this because making an inline 'onlick=makePassword()' is against the Content Security Policy (CSP)
    // we also have to do it after the Document Object Model (DOM) loads or our JS won't be able to load our button
    const pwordButton = document.getElementById("wand-button");
    if (pwordButton)
    {
        pwordButton.addEventListener("click", makePassword);
    }
    
    const copyButton = document.getElementById("copy-button");
    if (copyButton)
    {
        copyButton.addEventListener("click", copyText);
    }
    
    document.addEventListener("keydown", function(event) {
        if (event.ctrlKey)
        {
            if (event.key == "c")
            {
                copyText();
            }
        }
    });
});

window.onkeyup = function(event) {
    if (event.key == " " || event.code == "Space" || event.keyCode == 32)
    {
        makePassword();
    }
}

function storePassword() {
    //begin the connection with the database, if there isn't one create one
    const request = window.indexedDB.open("databaseName", 3);

    //handling the request object we received back, this whole indexedDB thing is asynchronous
    request.onerror = (event) => {
        //well I guess it errored, most likely permissions issue
        console.error("Password Generator most likely needs storage permissions in order to maintain the password while not actively running");
        console.error(`Database error: ${event.target.error?.message}`);
    };

    request.onupgradeneeded = (event) => {
        const objectStore = db.createObjectStore("passwords");

        objectStore.createIndex("password", "password", { unique: false });

        // Use transaction oncomplete to make sure the objectStore creation is
        // finished before adding data into it.
        objectStore.transaction.oncomplete = (event) => {
            // Store values in the newly created objectStore.
            const customerObjectStore = db
            .transaction("customers", "readwrite")
            .objectStore("customers");
            customerData.forEach((customer) => {
            customerObjectStore.add(customer);
            });
        };
    };

    request.onsuccess = (event) => {
        //saving the database object we have for later
        db = event.target.result;
    };
}

function playCopyAnimation() {
    var targetElement = document.getElementById("text-display");
    targetElement.classList.add("copying-animation");
    //remove class after animation plays
    setTimeout(() => {
        targetElement.classList.remove("copying-animation");
    }, 300);
}

function playGenerationAnimation() {
    var targetElement = document.getElementById("text-display");
    targetElement.classList.add("generation-animation");
    //remove class after animation plays
    setTimeout(() => {
        targetElement.classList.remove("generation-animation");
    }, 300);
}

function copyText() 
{
    // Get the text field
    var copyText = document.getElementById("text-display");
  
    // Select the text field
    copyText.select();
    copyText.setSelectionRange(0, 99999); // For mobile devices
  
     // Copy the text inside the text field
    document.execCommand("copy");
  
    // Deselect the text (remove selection)
    window.getSelection().removeAllRanges();

    // Create a new range that doesn't highlight anything
    var range = document.createRange();

    // Select a point in the document (e.g., at the very beginning of the body)
    range.selectNodeContents(document.body);
    range.setStart(document.body, 0); // Start the range at the very beginning of the body
    range.setEnd(document.body, 0); // End the range at the same point

    // Apply the empty selection
    window.getSelection().addRange(range);

    playCopyAnimation();
}

function makePassword()
{    
    //clear the password
    password = "";

    password += selectRandomSymbol();
    password += selectWord();
    password += capitaliseFirstLetter(selectWord());
    //password =  replaceLettersWithNumbers(password);
    password += selectRandomNumber();
    password += selectRandomNumber();
    password += selectRandomSymbol();
 
    document.getElementById("text-display").value = password;

    playGenerationAnimation();
}
 
function selectWord() { // Selects one random word from the selected word list and adds it to the global password variable
    var randomnumber = Math.floor((Math.random() * wordList.length) + 0)
    var tempWord = wordList[randomnumber];
 
    if (password.includes(tempWord) == true) {
        var differentWords = false;
 
        while (differentWords == false) {
            tempWord = wordList[Math.floor((Math.random() * wordList.length) + 0)];
 
            if (password.includes(tempWord) == false) {
                differentWords = true;
            } else {
                continue;
            }
        }
    }
 
    return tempWord;
    //password += tempWord;
}
 
function selectRandomNumber() { // Makes a random number between 0 - 9
    return Math.floor((Math.random() * 10) + 0);
    //password += Math.floor((Math.random() * 10) + 0);
}

function selectRandomSymbol() { // Selects a random symbol from the list of symbols below
    var baseSymbols = ["!", "$", "%", "*", ".", "#"];

    return baseSymbols[Math.floor((Math.random() * baseSymbols.length) + 0)];
    //password += baseSymbols[Math.floor((Math.random() * baseSymbols.length) + 0)];
}
 
function replaceLettersWithNumbers(word) {
    var replacements = {
        "l": "1",
        "e": "3",
        "s": "5",
        "b": "8",
        "o": "0",
        "t": "+"
    }

    var chanceSuccess = 50;

    //replaces one letter with a symbol
    for (let i in word)
    {
        if (word.toLocaleLowerCase() in replacements)
        {
            var randomRoll = Math.floor((Math.random() * 100))
            if (randomRoll <= chanceSuccess)
            {
                word[i] = replacements[word[i].toLocaleLowerCase()];
                //var temp = word.replace(word[i].toLocaleLowerCase(), replacements[word[i].toLocaleLowerCase()]);
                return word;
            }
        }
    }

    //var chanceToCompare = 5;
    //// Gen a number between 1 and 100 then check if it is less than or equal to the chance number set
    //for (let i in password) {
    //    if (password[i].toLocaleLowerCase() in replacements) {
    //        var chance = Math.floor((Math.random() * 100));
    //        if (chance <= chanceToCompare) {
    //            password[i] = replacements[password[i].toLocaleLowerCase()];
    //            var temp = password.replace(password[i].toLocaleLowerCase(), replacements[password[i].toLocaleLowerCase()]);
    //            password = temp;
    //        }
    //    }
    //}

    return word;
}
 
function replaceLettersWithSymbols() {
    var baseSymbols = ["@", "$", "!"];
    var excludeSymbols = document.getElementById("excludeSymbols").value.split("");
 
    var possibleSymbols = [];
 
    for(let i = 0; i < baseSymbols.length; i++){
        if(excludeSymbols.includes(baseSymbols[i]) == false){
            possibleSymbols.push(baseSymbols[i]);
        }
    }
 
    var replacements = {
        "a": "@",
        "s": "$",
        "i": "!"
    }
 
    var chanceToCompare = parseInt(document.getElementById("replaceSymbolSlider").value);
    // Gen a number between 1 and 100 then check if it is less than or equal to the chance number set
    for (let i in password) {
        if (password[i].toLocaleLowerCase() in replacements) {
            var chance = Math.floor((Math.random() * 100));
            if (chance <= chanceToCompare) {
                if(possibleSymbols.includes(replacements[password[i].toLocaleLowerCase()])){
                    password[i] = replacements[password[i].toLocaleLowerCase()];
                    var temp = password.replace(password[i].toLocaleLowerCase(), replacements[password[i].toLocaleLowerCase()]);
                    password = temp;
                }
            }
        }
    }
}
 
function capitaliseFirstLetter(word) {
    tempWord = "";

    let array = word.split("");
    array[0] = array[0].toUpperCase();

    for (let i = 0; i < array.length; i++)
    {
        tempWord += array[i];
    }

    return tempWord;
}